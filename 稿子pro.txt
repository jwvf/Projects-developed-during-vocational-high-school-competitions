服务器：
在传统工业互联网服务器架构中，常需要架设大批量的高性能计算集群。究其原因，是服务器软件架构和通讯协议的层层嵌套导致的计算资源浪费。在我的设计中，我使用了4层软件架构，每个架构职责分明。增加了项目的可维护性。
首先是入口层，其拥有一个AsyncServer类，它是异步服务器的核心，负责管理客户端的协议与解析。首先是自研的极简通讯协议，我模仿TCP/IP的三次握手并进行精简。将单次读写消耗的网络带宽从modbus-tcp的80字节消耗减少到20字节，有效降低了交换机的性能压力。
关于性能优化，我还采用了高连接队列，内核缓冲区优化等技术，大大降低了高吞吐量对服务器的计算压力。
除此之外，我还添加了一个调试协程。通过进程分离，我将input阻塞式输入与主线程分离开，实现了不停机维护。
其次是数据管理层，我实现了线程安全的共享变量存储。采用预分配列表与叫可重入锁，防止内存碎片化与锁竞争导致的读写效率下降和内存利用率降低。当客户端反复读取同一寄存器时，我采用快速路径返回，不在重复读取变量。实现了无锁开销。
然后是网络通信层。我基于selectors实现了非阻塞IO封装库。基于收发缓冲区与内存视图实现了内存访问的零拷贝，将大批量数据传输的CPU占用率降低50%以上，同时节省40%内存带宽。让企业在选择服务器时无需购买高端服务器，节省大量服务器部署成本。
最后是配置管理层，它实现了配置参数的同一管理。其主要函数（get函数）支持嵌套访问，能有效添加配置文件的直观程度。我们还支持配置参数的热重载，让用户在更改配置后无需重启服务器，即可修改参数，增加了服务器上线的效率。

视觉：
现有产线中，产品的检测主要靠人工识别。这会导致以下问题，1：效率低下，人力成本高。2：准确性与与一致性过低。3：可扩展性与灵活性差。4：数据追溯能力薄弱。为了解决以上问题，我完成了工业视觉检测系统的搭建。硬件选型我们采用了奥比中光的Femto Bolt RGB-D相机，其可直接输出4K30赫兹视频和1024x1024 15赫兹的深度信息，被广泛用于机器视觉检测。
在核心模块层，我们依托奥比官方SDK开发了相机管理模块，实现了软硬件分离。更换相机无需重写所有代码，大大减少了企业换型成本。此模块实现了相机的自动初始化，双模式对齐，数据的标准化与异常处理和自动资源管理。
关于二维码识别模块，我为其添加了自适应二维码识别和处理参数的手动调优。基于高斯模糊，自适应阈值，形态学运算，我将复杂场景的二维码图像转换为清晰的二值图像。这一操作有效增加了二维码识别的成功率，并且可以适应不同的光照环境，增强了模块的泛用性。此模块还可直接运行，以用于识别区域选择和实时参数调节。
工具层我实现了从采集到测试的完整流程，用于视觉初期部署。点云查看工具是用于将深度模板转化为3d点云并可视化。它拥有以下优点，1：自动读取相机内参并缩放到标准尺寸。2：将标准点云使用open3d交互式展示。3：可导出为PLY格式的标准点云文件。基于以上优点，可实现从简单应用到工厂数字化建模的全流程应用。
模板采集工具则用于交互式录制模板与存储。我使用可缩放窗口，兼容了任意分辨率的屏幕，并且保留了原图数据反算出原图坐标以保留精度。不仅如此，我还实现了跳过，重绘，放弃等交互操作。深度模板以32位浮点数保存，可实现0.1mm级精度存储。并且我还在可视化中实时展示当前绘制区域。实现了高效的人机交互。
应用服务层是整个视觉的核心，它有三种工作模式，支持待机模式降低功耗。模板匹配模式先进行模板的灰度转换以供后续调用。然后从相机管理模块获取对齐后的RGB-D帧。在这里，为了应对多模板检测，我采用了并行模板匹配以减少识别耗时。二维码识别模式则调用二维码识别模块完成二维码的识别并上传服务器以供后续溯源。Numba JIT编译加速深度计算让我的深度检测算法检测效率提升60%以上。该视觉检测系统取代了传统人工检测，解决了效率低下，一致性过低，溯源困难的啥问题。降低了企业的生产成本。

MES系统：
在传统制造业中，产量数据依赖手工记录和纸质单据，存在生产进度掌控滞后，设备闲置、计划不合理等问题。为此，我引入了制造执行系统（MES系统），我们的系统基于以下架构。
前端展示模块其核心功能是实现数据监控和订单管理，我们完成了视图切换机制，设备启停控制和产量清零功能。我还为其添加了数值变化动画，让展示更生动。
后端API层则是实现上述功能的基础，基于FastAPI应用核心实现应用实例的创建与配置，资源文件的挂载和重定向逻辑。订单管理接口则可获取订单的数据模型并实现订单执行业务逻辑，让我们的MES系统可支撑数字化转型。历史数据服务是监视产量数据的核心，它采用内存队列维护技术，保证不会出现内存溢出问题，定时采集线程是独立在主线程之外的，其核心功能是每5分钟采集一次产量数据，并将数据放入内存中，采用独立线程的好处是。一旦主线程应网络波动卡死，其产量数据也不会丢失。数据持久化层是存储订单数的核心层，它的任务是将订单数据写入硬盘，防止应意外断电导致的数据丢失。存储格式采用通用JSON数据格式，它具有高可读性与通用性，可完美解决数据迁移困难的问题。关于系统的集成与部署，我基于fastapi等python通用高性能开源库，部署难度显著降低，可兼容市面上绝大多数硬件。